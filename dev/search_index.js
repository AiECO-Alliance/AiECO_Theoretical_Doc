var documenterSearchIndex = {"docs":
[{"location":"AiECO_SnowCore/#AiECO-Snowpack-Model","page":"AiECO Snow Core","title":"AiECO Snowpack Model","text":"This page documents the Snow module API used by AiECO.","category":"section"},{"location":"AiECO_SnowCore/#Ace1.Snow_Mod.hmean","page":"AiECO Snow Core","title":"Ace1.Snow_Mod.hmean","text":"hmean(a, b, da, db) -> hm\n\nHarmonic mean helper used for interface conductances.\n\nmathrmhm =\nbegincases\ndfrac2abad_b + bd_a  ad_b + bd_a  0 \n0  textotherwise\nendcases\n\n\n\n\n\n","category":"function"},{"location":"AiECO_SnowCore/#Ace1.Snow_Mod.cap_remove","page":"AiECO Snow Core","title":"Ace1.Snow_Mod.cap_remove","text":"cap_remove(x, V, xA) -> x_capped\n\nCap a (possibly negative) tendency/flux x so it cannot remove more than V*xA in one substep.\n\nx_mathrmcapped = maxbig(x-max(0 Vx_A)big)\n\nThis is the same limiter pattern used repeatedly in the ecosys-style code to enforce non-negativity of water stores under explicit splitting.\n\n\n\n\n\n","category":"function"},{"location":"AiECO_SnowCore/#Ace1.Snow_Mod.vpsat","page":"AiECO Snow Core","title":"Ace1.Snow_Mod.vpsat","text":"vpsat(TK) -> υsat\n\nEcosys-style saturation vapor \"VP\" used by the snow solver.\n\nSaturation form (as in your translation):\n\nupsilon^ast(T)\n= frac2173times 10^-3T(061)\nexpleft5360left(3661times 10^-3-frac1Tright)right\n\nNotes\n\nThis is not saturation vapor pressure in Pa.\nIt is consistent with the model’s internal “vapor concentration / water-equivalent” convention, commonly used as (\\upsilon \\approx V^{v}/V^{a}) where:\n(V^{v}) is a vapor water-equivalent store\n(V^{a}) is air-filled volume\nInput (T) is in Kelvin.\n\nReturns\n\nυsat: (\\upsilon^{\\ast}(T)) in the model’s internal units.\n\n\n\n\n\n","category":"function"},{"location":"AiECO_SnowCore/#Ace1.Snow_Mod.layer_props!","page":"AiECO Snow Core","title":"Ace1.Snow_Mod.layer_props!","text":"layer_props!(Va, υ, C, dz, Vlyr, Vs, Vw, Vi, Vv, cs, cw, ci, A)\n\nCompute per-layer helper properties used by transport and sources.\n\nDefinitions (per layer (L)):\n\nAir-filled volume:\n\nV^a_L = maxleft(0V^lyr_L - V^s_L - V^w_L - V^i_Lright)\n\nVapor “concentration” (internal convention):\n\nupsilon_L =\nbegincases\nV^v_L  V^a_L  V^a_L0\n0  V^a_L=0\nendcases\n\nHeat capacity (per ground area):\n\nC_L = c_s V^s_L + c_w(V^w_L+V^v_L) + c_i V^i_L\n\nLayer thickness:\n\nDelta z_L = V^lyr_L  A\n\nInputs\n\nVlyr[L]: total layer volume per ground area (your snow_VolLyr_L[L] concept)\nVs,Vw,Vi,Vv[L]: stores (water-equivalent volumes per ground area)\ncs,cw,ci: heat capacities per water-equivalent volume\nA: area scaling (often Area[3,NUM])\n\nOutputs (written in-place)\n\nVa[L]: (V^{a}_L)\nυ[L]: (\\upsilon_L)\nC[L]: (C_L)\ndz[L]: (\\Delta z_L)\n\n\n\n\n\n","category":"function"},{"location":"AiECO_SnowCore/#Ace1.Snow_Mod.surf_flux","page":"AiECO Snow Core","title":"Ace1.Snow_Mod.surf_flux","text":"surf_flux(T, Vs, Vw, Vi;\n          SW, LW, epsσ,\n          Tc, fc, Td, fd,\n          Ta, υa,\n          Ke, Kh,\n          Lv, Ls, cw, cs,\n          Ps, Pw, Pi, Qin,\n          xA) -> (Fs, Fw, Fi, Fh, diag)\n\nSnow surface exchange for the top snow layer (surface layer (L=1)).\n\nThis computes surface energy/mass exchange and returns the boundary fluxes at the snow–atmosphere interface (interface (1/2)).\n\nState (top layer)\n\n(V^{s},V^{w},V^{i}): snow/solid, liquid water, and ice stores\n(T): snow surface-layer temperature (K)\n\nForcing/parameters\n\nRadiation: (SW{\\downarrow}, LW{\\downarrow}), emission factor (\\varepsilon\\sigma)\nCanopy/standing-dead LW exchange: ((Tc,fc)), ((Td,fd))\nAir: ((Ta,\\upsilona))\nBulk transfer coefficients: (Ke) (vapor), (Kh) (sensible)\nLatent constants: ((Lv,Ls))\nExchanged-mass heat capacities: ((cw,cs))\nPrecip/additions: ((P^{s},P^{w},P^{i},Q_{in}))\nLimiter factor: xA (your ecosys-style per-substep cap, e.g. XNPAX)\n\nEquations\n\nAlbedo closure (volume-weighted):\n\nalpha\n=\nfrac085V^s+030V^i+006V^wV^s+V^i+V^w\n\nNet radiation:\n\nR_n\n=\n(1-alpha)SW_downarrow+LW_downarrow\n-varepsilonsigma T^4\n+varepsilonsigma(T_c^4-T^4)f_c\n+varepsilonsigma(T_d^4-T^4)f_d\n\nVapor exchange:\n\nE^ast = K_ebig(upsilon_a-upsilon^ast(T)big)\n\nPartition (capped by availability):\n\nE^w=maxleft(E^ast -V^wx_Aright)qquad\nE^s=maxleft(min(0E^ast-E^w) -V^sx_Aright)\n\nLatent + sensible:\n\nLE = L_v E^w + L_s E^sqquad\nH = K_h(T_a-T)\n\nAdvective/enthalpy correction (your sign rule):\n\nH_v\n=\nbegincases\n(c_wE^w+c_sE^s)T    E^ast0\n(c_wE^w+c_sE^s)T_a  E^astge 0\nendcases\n\nTotal surface energy into snow:\n\nG_0 = R_n + LE + H + H_v\n\nBoundary fluxes at interface (1/2):\n\nF^s_12=P^s+E^squad\nF^w_12=P^w+E^wquad\nF^i_12=P^iquad\nF^h_12=Q_in+G_0\n\nOutputs\n\nReturns (Fs, Fw, Fi, Fh, diag) where:\nFs,Fw,Fi,Fh correspond to (F^{s}{1/2},F^{w}{1/2},F^{i}{1/2},F^{h}{1/2})\ndiag is a NamedTuple of helpful diagnostics ((\\alpha,Rn,E^{w},E^{s},LE,H,Hv,G_0)).\n\n\n\n\n\n","category":"function"},{"location":"AiECO_SnowCore/#Ace1.Snow_Mod.surf_flux!","page":"AiECO Snow Core","title":"Ace1.Snow_Mod.surf_flux!","text":"surf_flux!(Fs, Fw, Fi, Fh, T, Vs, Vw, Vi; kwargs...)\n\nIn-place wrapper for surf_flux that writes fluxes into Refs:\n\nFs = F^s_12quad\nFw = F^w_12quad\nFi = F^i_12quad\nFh = F^h_12\n\nSee surf_flux for equations and parameter meanings.\n\n\n\n\n\n","category":"function"},{"location":"AiECO_SnowCore/#Ace1.Snow_Mod.flux_internal!","page":"AiECO Snow Core","title":"Ace1.Snow_Mod.flux_internal!","text":"flux_internal!(Fw, Fv, Fh, Vs, Vw, T, Va, υ, dz, k, Dv;\n               A, fs, cw, xA, xY, θmin)\n\nCompute internal interface fluxes inside the snowpack.\n\nIndex convention for interface arrays (length (J+1)):\n\nindex 1  = interface (1/2) (set by surf_flux!)\nindex L+1 = interface (L+1/2)\nindex J+1 = interface (J+1/2) (set by bottom_exchange!)\n\nTypical equations (implementation pattern)\n\nLiquid percolation (excess rule):\n\nq^w_L+12\n= minleft(theta^a_L+1 max(0 V^w_L-005V^s_L)x_Aright)\n\nVapor diffusion:\n\nq^v_L+12 = K^v_L+12(upsilon_L-upsilon_L+1)\n\nHeat flux (conduction + liquid enthalpy):\n\nq^h_L+12\n= K^h_L+12(T_L-T_L+1) + c_w T_Lq^w_L+12\n\nImplementation notes\n\nHarmonic means are used for conductances: (K^{v}{L+1/2}\\leftarrow\\mathrm{hmean}(Dv[L],Dv[L+1],\\Delta zL,\\Delta z{L+1})), (K^{h}{L+1/2}\\leftarrow\\mathrm{hmean}(k[L],k[L+1],\\Delta zL,\\Delta z{L+1})).\nθmin prevents zero “receiving capacity” in very dry/degenerate states; replace with your own physically-based cap if desired.\nxY is a scaling factor that you can use to mirror your XNPYX-style interface scaling; set xY=1.0 if you don’t need it.\n\nInputs\n\nLayer arrays: Vs,Vw,T,Va,υ,dz,k,Dv\nScalars: A (area factor), fs (snow cover), cw, xA, xY, θmin\n\nOutputs\n\nWrites for (L=1..J-1):\nFw[L+1] = liquid flux across (L+1/2)\nFv[L+1] = vapor flux across (L+1/2) scaled by A*fs*xY\nFh[L+1] = heat flux across (L+1/2) scaled by A*fs*xY\n\n\n\n\n\n","category":"function"},{"location":"AiECO_SnowCore/#Ace1.Snow_Mod.vapor_relax!","page":"AiECO Snow Core","title":"Ace1.Snow_Mod.vapor_relax!","text":"vapor_relax!(Vs, Vw, Vv, Va, T; Lv, Ls, xA) -> (Ww, Ws, Qv)\n\nIn-layer vapor relaxation toward saturation.\n\nThis is the layer-local evaporation/condensation adjustment used to relax the vapor store (V^{v}) toward (\\upsilon^{\\ast}(T)V^{a}).\n\nEquations\n\ndelta = V^v - upsilon^ast(T)V^a\n\nW^w = max(delta-V^wx_A)qquad\nW^s = maxbig(min(0delta-W^w)-V^sx_Abig)\n\nQ_v = L_vW^w + L_sW^s\n\nInputs\n\nVs,Vw,Vv,Va,T: layer-local stores and temperature\nLv,Ls: latent constants (matching your model convention)\nxA: cap factor (like your XNPAX)\n\nOutputs\n\nWw corresponds to (W^{w}) (liquid exchange term)\nWs corresponds to (W^{s}) (snow/solid exchange term)\nQv corresponds to (Q_v) (latent energy term)\n\nIntended conservative application (matching your code’s sign convention):\n\nVs ← Vs + Ws\nVw ← Vw + Ww\nVv ← Vv - (Ws + Ww)\nEnergy increment +Qv\n\n\n\n\n\n","category":"function"},{"location":"AiECO_SnowCore/#Ace1.Snow_Mod.Freeze_Thaw!","page":"AiECO Snow Core","title":"Ace1.Snow_Mod.Freeze_Thaw!","text":"freeze_thaw!(Vs, Vw, Vi, Vv, T; cs, cw, ci, Tf, Lf, xX, ρi) -> (Wfs, Wfi, Qf)\n\nFreeze–thaw in a snow layer driven by thermal imbalance (ecosys-style).\n\nThis is a compact rewrite of your freeze–thaw block using short names.\n\nHeat capacity proxy:\n\nC^ast=c_sV^s+c_w(V^w+V^v)+c_iV^i\n\nEnergy tendency:\n\nH_1 = C^ast(T_f - T)27185cdot x_X\n\nBranches (mirrors your code logic)\n\nIf (H_1 < 0): melting-like branch; partition among snow/ice by their fractions.\nElse: freezing-like branch; limited by available liquid.\n\nOutputs\n\nWfs (analog of your WFLFSX): snow/solid melt term (subtracted from (V^{s}) update)\nWfi (analog of your WFLFIX): liquid→ice term in water-equivalent units (ice update uses -Wfi/ρi)\nQf  (analog of your HFLF0X): latent energy term\n\nIntended application (aligned with your original update pattern):\n\nVs ← Vs - Wfs\nVw ← Vw + Wfs + Wfi\nVi ← Vi - Wfi/ρi\nEnergy increment +Qf\n\nNotes\n\nLf corresponds to the “333” coefficient used in your code’s internal unit system.\nxX corresponds to your XNPXX.\nρi corresponds to soil_iceDensty.\n\n\n\n\n\n","category":"function"},{"location":"AiECO_SnowCore/#Ace1.Snow_Mod.Snow_FluxEchg!","page":"AiECO Snow Core","title":"Ace1.Snow_Mod.Snow_FluxEchg!","text":"Snow_FluxEchg!(Vs,Vw,Vi,Vv,T;\n           Vlyr, A,\n           Va, υ, C, dz,\n           Fs,Fw,Fi,Fv,Fh,\n           k,Dv,\n           cs,cw,ci,\n           Lv,Ls, Tf,Lf, ρi,\n           xA,xX,xY, dt,\n           sf,\n           bottom_cb=bottom_exchange!) -> bot\n\nOne conservative snow substep (finite-volume style).\n\nOrchestrates:\n\nlayer_props! (compute (V^{a},\\upsilon,C,\\Delta z))\nsurf_flux! (top boundary fluxes at (1/2))\nflux_internal! (internal interfaces (L+1/2))\nbottom_cb (bottom boundary (J+1/2))\nFlux divergence update\nOperator-split sources: vapor_relax! and freeze_thaw!\n\nCore update (flux divergence)\n\nFor any store (X\\in{V^{s},V^{w},V^{i},V^{v}}):\n\nX_L^n+1\n=\nX_L^n\n+\nleft(F^X_L-12 - F^X_L+12right)Delta t_s\n+ S_L^X\n\nEnergy in (CT) form:\n\n(CT)_L^n+1\n=\n(CT)_L^n\n+\nleft(F^h_L-12 - F^h_L+12right)Delta t_s\n+ S_L^E\n\nInputs\n\nState arrays (length (J)): Vs,Vw,Vi,Vv,T\nGeometry: Vlyr, A\nWork arrays (length (J)): Va,υ,C,dz\nInterface flux arrays (length (J+1)): Fs,Fw,Fi,Fv,Fh\nTransport props: k,Dv\nConstants: cs,cw,ci, Lv,Ls, Tf,Lf,ρi\nScaling factors:\nxA (like XNPAX) caps per-substep removals\nxX (like XNPXX) freeze–thaw scaling\nxY (like XNPYX) interface scaling (set 1.0 if unused)\nTime step: dt (this is your (\\Delta t_s) for the snow substep)\nsf (surface forcing NamedTuple) must include fields:\nSW, LW, epsσ, Tc, fc, Td, fd, Ta, υa, Ke, Kh, Ps, Pw, Pi, Qin, fs, θmin\n\nOutputs\n\nUpdates the state arrays in-place.\nReturns the NamedTuple from bottom_cb (so you can access partitioned diagnostics if you include them).\n\n\n\n\n\n","category":"function"},{"location":"EnergyFlux_Exchange_Soil/#AiECO-Energy-(Vapor)-Flux-Exchange-within-Air–Residue-Soil","page":"AiECO Soil Energy Core","title":"AiECO Energy (Vapor) Flux Exchange within Air<–>Residue<->Soil","text":"by Tongxi Hu (t.hu@colostate.edu)\n\njulia id=\"f8y9sq\" using Ace1","category":"section"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.AirState","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.AirState","text":"AirState(T_a, e_a)\n\nGround-air node just above the surface.\n\nUnits\n\nT_a [K]\ne_a : vapor variable (Pa if you keep default e_sat; otherwise your VP units)\n\nSymbol map\n\nT_a ↔ T_a\ne_a ↔ e_a (vapor concentration)\n\n\n\n\n\n","category":"type"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.Conductances","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.Conductances","text":"Conductances(g_v_s, g_h_s, g_v_r, g_h_r, g_v_rs)\n\nTransfer conductances supplied by your aerodynamic/resistance scheme.\n\nFlux forms\n\nE = g_v (e_a - e^*)\n\nH = g_h (T_a - T)\n\nUnits\n\ng_v_* must convert a vapor-variable gradient to the same units as E (store per time).\ng_h_* must convert a temperature gradient to an energy flux (per time).\n\nField meanings\n\ng_v_s, g_h_s: air ↔ soil surface\ng_v_r, g_h_r: air ↔ residue surface\ng_v_rs: residue ↔ soil vapor coupling (optional; set 0.0 to disable)\n\n\n\n\n\n","category":"type"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.HeatCapacities","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.HeatCapacities","text":"HeatCapacities(C_s, C_r)\n\nAreal heat capacities for soil surface and residue nodes.\n\nUsage\n\nIf C_s > 0, Solve_Flux_Exchange_Kernel! may update T_s internally.\nIf C_r > 0, Solve_Flux_Exchange_Kernel! may update T_r internally.\nIf C_* <= 0, temperatures are not updated (flux-only mode).\n\nUnits Energy per area per Kelvin.\n\n\n\n\n\n","category":"type"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.RadiationForcing","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.RadiationForcing","text":"RadiationForcing(SW, LW_in, albedo, c_emit, c_can, c_dead, T_can, T_dead)\n\nRadiation and LW-exchange coefficients for a surface node.\n\nNet radiation form used\n\nR_n(T) = (1-alpha)SW + LW_in - c_emitT^4\n         + c_can(T_can^4 - T^4) + c_dead(T_dead^4 - T^4)\n\nNotes\n\ntextEmitted LW = c_emitT^4\n\ntextCanopyDead exchange propto (T_source^4 - T^4)\n\nwith canopy factors folded into c_can and c_dead.\n\nUnits All radiation terms must be (W m⁻²).\n\n\n\n\n\n","category":"type"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.ResidueState","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.ResidueState","text":"ResidueState(T_r, psi_r, W_r)\n\nResidue/litter surface node (optional).\n\nUnits\n\nSame conventions as soil surface:\n\nT_r (K)\npsi_r (MPa)\nW_r residue water store used to limit evaporation\n\n\n\n\n\n","category":"type"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.SoilSurfaceState","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.SoilSurfaceState","text":"SoilSurfaceState(T_s, psi_s, W_s)\n\nSoil surface node.\n\nUnits\n\nT_s (K)\npsi_s (MPa) \nW_s : available surface water store used to limit evaporation over a step\n\nNotes\n\nW_s only needs to be consistent with the limiter in vapor_flux_limited.\n\n\n\n\n\n","category":"type"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.SurfaceFluxes","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.SurfaceFluxes","text":"SurfaceFluxes()\n\nContainer of mean fluxes over the time step (or mean over substeps).\n\nSoil-surface fluxes\n\nRn_s: net radiation\nH_s: sensible heat\nLE_s: latent heat\nJh_s: enthalpy advected with mass flux\nE_s: vapor mass flux (negative = evaporation)\n\nLE_s = lambda E_s qquad Jh_s = E_s c_pw T_src\n\nResidue fluxes\n\nAnalogous fields Rn_r, H_r, LE_r, Jh_r, E_r.\n\nResidue–soil exchange\n\nQ_rs: conductive heat exchange (+ if residue warmer than soil)\nFv_rs: vapor exchange (+ if residue vapor variable > soil)\nJh_rs: enthalpy with Fv_rs\n\n\n\n\n\n","category":"type"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.ThermalCoupling","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.ThermalCoupling","text":"ThermalCoupling(G_rs_base, use_free_convection, g,beta,nu,alpha,θ,θcrit,Ra_max)\n\nResidue-soil conductive coupling:\n\nQ_rs = G_rs * (T_r - T_s)\n\nOptional enhancement:\n\nG_rs = G_rsbase cdot Nu(RaPr)\n\nSet use_free_convection=false to use G_rs_base directly.\n\n\n\n\n\n","category":"type"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.Solve_Flux_Exchange_Kernel!-Tuple{AirState, SoilSurfaceState, Union{Nothing, ResidueState}, Conductances, RadiationForcing, RadiationForcing, HeatCapacities, ThermalCoupling}","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.Solve_Flux_Exchange_Kernel!","text":"Solve_Flux_Exchange_Kernel!(air, soil, residue, cond, rad_s, rad_r, hc, tc;\n            dt, λ, c_pw, C_kelvin=18/R, snow_free=1.0, litter_cover=1.0, nsub=10)\n\nAdvance one time step of the coupled system.\n\nMethods equations (core)\n\nKelvin equilibrium:\n\ne^*(Tpsi) = e_sat(T)expleft(C_kelvinfracpsiTright)\n\nVapor flux (limited):\n\nE = g_v(e_a - e^*)qquad Ege -fracWDelta t\n\nHeat fluxes:\n\nH = g_h(T_a - T)quad LE=lambda Equad J_h = E c_pw T_src\n\nNet radiation:\n\nR_n(T) = (1-alpha)SW + LW_in - c_emitT^4 + c_can(T_can^4-T^4)+c_dead(T_dead^4-T^4)\n\nResidue–soil conduction (if residue present):\n\nQ_rs = G_rs(T_r - T_s)\n\nWhat this function updates\n\nAlways updates water stores soil.W_s and (if present) residue.W_r.\nUpdates temperatures only when corresponding heat capacity is positive:\nif hc.C_s > 0: updates soil.T_s\nif hc.C_r > 0: updates residue.T_r\n\nOptions\n\nsnow_free, litter_cover are multiplicative masks on surface fluxes.\nnsub substeps are used when residue is present for numerical stability.\nC_kelvin default 18/R assumes ψ in MPa (ecosys-consistent).\n\n\n\n\n\n","category":"method"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.dnusselt_churchill_chu-Tuple{Float64}","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.dnusselt_churchill_chu","text":"dnusselt_churchill_chu(Pr) -> denom\n\nChurchill–Chu denominator term:\n\nleft(1 + (0492Pr)^916right)^49\n\nUsed in the classic natural-convection correlation for Nu(Ra,Pr).\n\n\n\n\n\n","category":"method"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.e_eq_kelvin-Tuple{Float64, Float64, Float64}","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.e_eq_kelvin","text":"e_eq_kelvin(TK, psi; C_kelvin) -> e_star\n\nKelvin-corrected equilibrium vapor variable at a surface.\n\nEquation\n\ne^*(Tpsi) = e_sat(T)expleft(C_kelvinfracpsiTright)\n\nChoosing C_kelvin (unit-critical)\n\n(ψ in MPa):\nC_kelvin = frac18R\nwhere 18 arises from V_w * (10^6 Pa/MPa).\nstrict SI choice (ψ in Pa):\nC_kelvin = fracV_wR\nwith V_w ≈ 18 × 10^-6 m^3 mol^-1 and ψ in Pa.\n\nUnits\n\nTK (K)\npsi (MPa)  \nOutput has the same units as e_sat(T) and air.e_a \n\nPhysical meaning\n\nAs soil/residue dries, ψ becomes more negative, e^* decreases, and evaporation is suppressed.\n\n\n\n\n\n","category":"method"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.e_sat-Tuple{Float64}","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.e_sat","text":"e_sat(TK) -> e_sat\n\nSaturated vapor pressure (Pa) at temperature T_K (K).\n\nDefault behavior\n\nand your conductance g_v is consistent with those units.\n\nUnits\n\nInput: TK (K)\nOutput: vapor pressure (Pa)\n\nNotes\n\nOnly consistency matters for the bulk-gradient flux:\n\nE = g_v (e_a - e^*)\n\n\n\n\n\n","category":"method"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.effective_G_rs-Tuple{Float64, Float64, ThermalCoupling}","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.effective_G_rs","text":"effective_G_rs(T_r, T_s, tc) -> G_rs\n\nEffective residue–soil conductance, optionally enhanced by free convection.\n\n\n\n\n\n","category":"method"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.enthalpy_flux-NTuple{4, Float64}","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.enthalpy_flux","text":"enthalpy_flux(E, c_pw, T_surface, T_air) -> Jh\n\nEnthalpy flux carried with the water mass transfer.\n\nEquation: \n\nJ_h = Ec_pwT_src\n\nSource temperature convention\n\nIf E < 0 (evaporation; mass leaves surface), use T_surface\nIf E > 0 (condensation; mass arrives from air), use T_air\n\nThis separates “advected sensible heat with mass transfer” from latent heat \\lambda E.\n\n\n\n\n\n","category":"method"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.net_radiation-Tuple{Float64, RadiationForcing}","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.net_radiation","text":"net_radiation(T, rad) -> Rn\n\nCompute net radiation R_n(T) for a surface. See RadiationForcing for the exact equation.\n\n\n\n\n\n","category":"method"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.nusselt_churchill_chu-Tuple{Float64, Float64}","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.nusselt_churchill_chu","text":"nusselt_churchill_chu(Ra, Pr) -> Nu\n\nNatural convection correlation (Churchill–Chu style), clamped to Nu >= 1:\n\nNu = maxleft(1068 + frac067Ra^14left(1 + (0492Pr)^916right)^49right)\n\nInterpretation: Nu = 1 is pure conduction; Nu > 1 enhances effective transport.\n\n\n\n\n\n","category":"method"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.prandtl-Tuple{Float64, Float64}","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.prandtl","text":"prandtl(nu, alpha) -> Pr\n\nPrandtl number:\n\nPr = fracnualpha\n\nnu: kinematic viscosity (momentum diffusivity)\nalpha: thermal diffusivity\n\nInterpretation: compares momentum diffusion to heat diffusion.\n\n\n\n\n\n","category":"method"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.rayleigh_porous-Tuple{Float64, Float64, Float64}","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.rayleigh_porous","text":"rayleigh_porous(ΔT, θ, θcrit; g,beta,nu,alpha,Ra_max) -> Ra\n\nEffective Rayleigh number in a porous phase using a connectivity proxy.\n\nProxy length scale:\nL_eff^3 = max(0theta - theta_crit)^3\nRayleigh number:\nRa = minleft(Ra_maxfracgbetanualphaDelta TL_eff^3right)\n\nConvection “turns on” only when a phase (air or water) is sufficiently connected above a threshold.\n\n\n\n\n\n","category":"method"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.rayleigh_prefactor-NTuple{4, Float64}","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.rayleigh_prefactor","text":"rayleigh_prefactor(g, beta, nu, alpha) -> pref\n\nRayleigh prefactor:\n\ntextpref = fracgbetanualpha\n\nSo a Rayleigh number can be formed as:\n\nRa = textpref(Delta T L^3)\n\nThis appears naturally when nondimensionalizing the Navier–Stokes + heat equation under the Boussinesq approximation (buoyancy-driven flow).\n\n\n\n\n\n","category":"method"},{"location":"EnergyFlux_Exchange_Soil/#Ace1.Solve_WaterEnergy_AirSoil.vapor_flux_limited-NTuple{5, Float64}","page":"AiECO Soil Energy Core","title":"Ace1.Solve_WaterEnergy_AirSoil.vapor_flux_limited","text":"vapor_flux_limited(g_v, e_air, e_eq, W_available, dt) -> E\n\nCompute vapor mass flux with an availability limiter.\n\nBase flux:\n\nE = g_v (e_air - e^*)\n\nLimiter (prevents over-evaporation):\n\nE ge -fracWDelta t\n\nSign\n\nE < 0 : evaporation (surface loses water)\nE > 0 : condensation (surface gains water)\n\nW_available is the surface store used only to enforce this bound.\n\n\n\n\n\n","category":"method"},{"location":"#Ai-enhanced-ECOsystem-(AiECO)-modeling-platform","page":"Home","title":"Ai-enhanced ECOsystem (AiECO) modeling platform","text":"Created by Dr. Tongxi Hu (T.Hu@colostate.edu)","category":"section"},{"location":"#What-it-is","page":"Home","title":"What it is","text":"A modern, modular ecosystem modeling platform that couples process-based conservation laws with selective, auditable AI components to improve capability without sacrificing interpretability.\nSimulates coupled energy–water–carbon–nutrient (N, P)–oxygen dynamics and exchanges across air–plant–soil–microbe systems for croplands, grasslands, forests, wetlands, and mixed landscapes.","category":"section"},{"location":"#Why-it’s-different","page":"Home","title":"Why it’s different","text":"Science-first core: built around mass/energy conservation, physically based fluxes, and budget diagnostics (so you can verify closure and trace errors).\nAI as a plug-in, not a replacement: AI modules are used where they add value—e.g., filling data gaps, accelerating components, or improving parameterizations—while keeping the mechanistic backbone intact.\nTransparent, testable design: every component can be benchmarked against observations and compared across model/AI configurations.","category":"section"},{"location":"#Software-advantages","page":"Home","title":"Software advantages","text":"Written in Julia to balance performance and productivity:\n\nNear HPC (Fortran/C/C++) performance while remaining readable and interactive for rapid development\nA single-language stack for research + production (no “prototype in Python, rewrite in Fortran” cycle)\n\nModular architecture: independent modules with well-defined interfaces (inputs/outputs/states), enabling:\n\nStandalone runs for unit testing and teaching\nSwapping alternative process representations (e.g., multiple snow or canopy options) without touching the whole model\n\nReproducible workflows: standardized I/O, configuration, and experiment tracking to support sensitivity analysis, ensembles, and model intercomparison.","category":"section"},{"location":"#State-of-the-art-science-modules-(examples)","page":"Home","title":"State-of-the-art science modules (examples)","text":"Radiation and canopy biophysics (energy balance, photosynthesis/respiration coupling, canopy–atmosphere exchange)\nSoil physics and hydrology (infiltration, redistribution, freeze–thaw, runoff/drainage options)\nBiogeochemistry (decomposition, microbial processes, mineralization/immobilization, nitrification/denitrification, plant uptake; extendable to P cycling)\nSnow and surface residue as optional, switchable components (activate only when needed for the ecosystem/climate).\nBuilt-in AI integration (pretrained or trained-by-user)\n\nAI-derived state estimation to replace missing or uncertain inputs (e.g., canopy traits, management timing, soil properties) with uncertainty tags.\nAI-augmented parameterization: learned mappings from site traits/climate/management to effective parameters, improving transferability across sites.\nAI surrogates/emulators for expensive components or ensembles (speed up calibration, UQ, scenario exploration) while maintaining checks against the full model.\nAI-enabled benchmarking: automated evaluation pipelines using remote sensing + in situ data, with consistent metrics and diagnostics.","category":"section"},{"location":"#Practical-outcomes-for-users","page":"Home","title":"Practical outcomes for users","text":"Faster learning curve for new contributors (readable code + standalone modules).\nFaster experiments (ensembles + surrogates + reproducible pipelines).\nMore trustworthy results (budget closure + transparent AI + benchmarking).","category":"section"},{"location":"WaterFlux_Exchange_Soil/#AiECO-Capillary-Water-Exchange:-Litter-Soil","page":"AiECO Soil Water Core","title":"AiECO Capillary Water Exchange: Litter <-> Soil","text":"This page summarizes the governing equations used by Ace1.Water_Mod.capillary_litt_soil_exchange!.","category":"section"},{"location":"WaterFlux_Exchange_Soil/#Core-Equations","page":"AiECO Soil Water Core","title":"Core Equations","text":"","category":"section"},{"location":"WaterFlux_Exchange_Soil/#1)-Volumetric-Water-Content","page":"AiECO Soil Water Core","title":"1) Volumetric Water Content","text":"theta^ell =\nbegincases\ndfracmin(C_ell V_ell)V_dryell  V_dryell  varepsilon \nphi_ell  textotherwise\nendcases\n\ntheta^s = mathrmclampleft(dfracV_sV_soil theta_mins phi_sright)","category":"section"},{"location":"WaterFlux_Exchange_Soil/#2)-Matric-and-Total-Potential","page":"AiECO Soil Water Core","title":"2) Matric and Total Potential","text":"(psi_m^ell theta^ell) = mathrmMCM(theta^ell) qquad\n(psi_m^s theta^s) = mathrmMCM(theta^s)\n\npsi^ell = psi_m^ell + psi_g^ell + psi_o^ell qquad\npsi^s = psi_m^s + psi_g^s + psi_o^s","category":"section"},{"location":"WaterFlux_Exchange_Soil/#3)-Conductance-and-Raw-Flux","page":"AiECO Soil Water Core","title":"3) Conductance and Raw Flux","text":"G = frac2 k^ell k^sk^ell L_s + k^s L_ell qquad\nF_raw = G(psi^ell - psi^s) A f_wet Delta tau_psi","category":"section"},{"location":"WaterFlux_Exchange_Soil/#4)-Bounded-Realized-Flux","page":"AiECO Soil Water Core","title":"4) Bounded Realized Flux","text":"V_airs = max(0V_caps - V_s - V_ices) qquad\nV_capell^rem = max(0C_ell - V_ell)\n\nLitter to soil (Fraw >= 0):\n\nF = maxleft(0min(F_corr V_ell Deltatau_v V_airs)right)\n\nSoil to litter (Fraw < 0):\n\nF = minleft(0max(F_corr -V_s Deltatau_v -V_capell^rem)right)","category":"section"},{"location":"WaterFlux_Exchange_Soil/#5)-Advected-Heat","page":"AiECO Soil Water Core","title":"5) Advected Heat","text":"H = c_pw T_src F qquad\nT_src =\nbegincases\nT_ell  F  0 \nT_s  F le 0\nendcases","category":"section"},{"location":"WaterFlux_Exchange_Soil/#API","page":"AiECO Soil Water Core","title":"API","text":"","category":"section"},{"location":"WaterFlux_Exchange_Soil/#Ace1.Water_Mod.MCM","page":"AiECO Soil Water Core","title":"Ace1.Water_Mod.MCM","text":"Fields:\n\nθ_FC : water content at field capacity\nϕ_FC : matric potential at field capacity (negative)\nθ_WP : water content at wilting point\nϕ_WP : matric potential at wilting point (negative)\nϕ    : porosity\nSRP  : shape parameter\n\n\n\n\n\n","category":"type"},{"location":"WaterFlux_Exchange_Soil/#Ace1.Water_Mod.capillary_litt_soil_exchange!-Tuple{Base.RefValue{Float64}, Base.RefValue{Float64}}","page":"AiECO Soil Water Core","title":"Ace1.Water_Mod.capillary_litt_soil_exchange!","text":"capillary_litt_soil_exchange!(Vℓ::Ref{Float64}, Vₛ::Ref{Float64}; kwargs...) -> (F̄, H̄)\n\nLiquid-phase capillary exchange between litter micropore water (ℓ) and soil micropore water (s).\n\nState and geometry\n\nStorages (volumes):\n\nVℓ : litter liquid volume\nVₛ : soil liquid volume\n\nConversions to volumetric water content:\n\nVdryℓ : litter dry volume\nVsoil : soil volume\n\nPorosities:\n\nϕℓ, ϕₛ\n\nPotentials and flux\n\nVolumetric water contents:\n\ntheta^ell=\nbegincases\ndfracmin(C_ellV_ell)V_dryell  V_dryellvarepsilon\nphi_ell  textotherwise\nendcases\nqquad\ntheta^s=mathrmclampleft(dfracV_sV_soiltheta_minsphi_sright)\n\nMatric potentials from MCM (your function):\n\n(psi_m^elltheta^ell)=mathrmMCM(theta^ell)qquad\n(psi_m^stheta^s)=mathrmMCM(theta^s)\n\nTotal potentials:\n\npsi^ell=psi_m^ell+psi_g^ell+psi_o^ellqquad\npsi^s=psi_m^s+psi_g^s+psi_o^s\n\nConductance and raw Darcy-like flux:\n\nG=frac2k^ellk^sk^ellL_s+k^sL_ell\nqquad\nF_raw=G(psi^ell-psi^s)A f_wetDeltatau_psi\n\nAir-entry correction is applied in code using θaeℓ and θaeₛ (same structure as ecosys).\n\nBounds (mass + capacity)\n\nDefine receiving pore space in soil:\n\nV_airs=max(0V_caps-V_s-V_ices)\n\nand remaining litter capacity:\n\nV_capell=max(0C_ell-V_ell)\n\nThen the realized flux is bounded as:\n\nIf Fraw ≥ 0 (ℓ→s):\n\nF=maxbig(0min(F_corrV_ellDeltatau_vV_airs)big)\n\nIf Fraw < 0 (s→ℓ):\n\nF=minbig(0max(F_corr-V_sDeltatau_v-V_capell)big)\n\nHeat advection\n\nAdvected sensible heat uses the source temperature:\n\nH=c_pwT_srcFquad\nT_src=begincases\nT_ellF0\nT_sFle 0\nendcases\n\nReturn and mutation\n\nReturns (F̄, H̄) accumulated over nsub internal substeps and updates the storages:\n\nV_ellleftarrow V_ell-Fqquad\nV_sleftarrow V_s+F\n\nRequired inputs (keywords)\n\nCℓ, Vdryℓ, Vsoil, ϕℓ, ϕₛ, θminₛ\nθaeℓ, θaeₛ\nψgℓ, ψoℓ, ψgₛ, ψoₛ\nkℓ[1:100], kₛ[1:100] (conductivity tables)\nLₛ, Lℓ, A, fwet\nΔτψ, Δτv, nsub\nc_pw, Tℓ, Tₛ\nVcapₛ, Viceₛ\npℓ::MCM, pₛ::MCM (MCM parameter bundles)\n\n\n\n\n\n","category":"method"}]
}
