<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>AiECO Snow Core · AiECO.jl</title><meta name="title" content="AiECO Snow Core · AiECO.jl"/><meta property="og:title" content="AiECO Snow Core · AiECO.jl"/><meta property="twitter:title" content="AiECO Snow Core · AiECO.jl"/><meta name="description" content="Documentation for AiECO.jl."/><meta property="og:description" content="Documentation for AiECO.jl."/><meta property="twitter:description" content="Documentation for AiECO.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">AiECO.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../EnergyFlux_Exchange_Soil/">AiECO Soil Energy Core</a></li><li><a class="tocitem" href="../WaterFlux_Exchange_Soil/">AiECO Soil Water Core</a></li><li class="is-active"><a class="tocitem" href>AiECO Snow Core</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>AiECO Snow Core</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>AiECO Snow Core</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/hutx2309/Ace1.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/hutx2309/Ace1.jl/blob/main/docs/src/AiECO_SnowCore.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="AiECO-Snowpack-Model"><a class="docs-heading-anchor" href="#AiECO-Snowpack-Model">AiECO Snowpack Model</a><a id="AiECO-Snowpack-Model-1"></a><a class="docs-heading-anchor-permalink" href="#AiECO-Snowpack-Model" title="Permalink"></a></h1><p>This page documents the Snow module API used by AiECO.</p><article><details class="docstring" open="true"><summary id="Ace1.Snow_Mod.hmean"><a class="docstring-binding" href="#Ace1.Snow_Mod.hmean"><code>Ace1.Snow_Mod.hmean</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">hmean(a, b, da, db) -&gt; hm</code></pre><p>Harmonic mean helper used for interface conductances.</p><p class="math-container">\[\mathrm{hm} \,=\,
\begin{cases}
\dfrac{2ab}{a\,d_b + b\,d_a}, &amp; a\,d_b + b\,d_a &gt; 0 \\
0, &amp; \text{otherwise}
\end{cases}\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/hutx2309/Ace1.jl/blob/c0a263b763345f4dafc42292e443fa5c7ffb26b0/src/snow/Snow_Mod.jl#L19-L31">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Ace1.Snow_Mod.cap_remove"><a class="docstring-binding" href="#Ace1.Snow_Mod.cap_remove"><code>Ace1.Snow_Mod.cap_remove</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">cap_remove(x, V, xA) -&gt; x_capped</code></pre><p>Cap a (possibly negative) tendency/flux <code>x</code> so it cannot remove more than <code>V*xA</code> in one substep.</p><p class="math-container">\[x_{\mathrm{capped}} = \max\big(x,\,-\max(0, V\,x_A)\big)\]</p><p>This is the same limiter pattern used repeatedly in the ecosys-style code to enforce non-negativity of water stores under explicit splitting.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/hutx2309/Ace1.jl/blob/c0a263b763345f4dafc42292e443fa5c7ffb26b0/src/snow/Snow_Mod.jl#L37-L49">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Ace1.Snow_Mod.vpsat"><a class="docstring-binding" href="#Ace1.Snow_Mod.vpsat"><code>Ace1.Snow_Mod.vpsat</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">vpsat(TK) -&gt; υsat</code></pre><p>Ecosys-style saturation vapor &quot;VP&quot; used by the snow solver.</p><p>Saturation form (as in your translation):</p><p class="math-container">\[\upsilon^{\ast}(T)
= \frac{2.173\times 10^{-3}}{T}\,(0.61)\,
\exp\!\left[5360\left(3.661\times 10^{-3}-\frac{1}{T}\right)\right]\]</p><p>Notes</p><ul><li>This is <strong>not</strong> saturation vapor pressure in Pa.</li><li>It is consistent with the model’s internal “vapor concentration / water-equivalent” convention, commonly used as (\upsilon \approx V^{v}/V^{a}) where:<ul><li>(V^{v}) is a vapor water-equivalent store</li><li>(V^{a}) is air-filled volume</li></ul></li><li>Input (T) is in Kelvin.</li></ul><p>Returns</p><ul><li><code>υsat</code>: (\upsilon^{\ast}(T)) in the model’s internal units.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/hutx2309/Ace1.jl/blob/c0a263b763345f4dafc42292e443fa5c7ffb26b0/src/snow/Snow_Mod.jl#L58-L81">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Ace1.Snow_Mod.layer_props!"><a class="docstring-binding" href="#Ace1.Snow_Mod.layer_props!"><code>Ace1.Snow_Mod.layer_props!</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">layer_props!(Va, υ, C, dz, Vlyr, Vs, Vw, Vi, Vv, cs, cw, ci, A)</code></pre><p>Compute per-layer helper properties used by transport and sources.</p><p>Definitions (per layer (L)):</p><p>Air-filled volume:</p><p class="math-container">\[V^{a}_L = \max\left(0,\;V^{lyr}_L - V^{s}_L - V^{w}_L - V^{i}_L\right)\]</p><p>Vapor “concentration” (internal convention):</p><p class="math-container">\[\upsilon_L =
\begin{cases}
V^{v}_L / V^{a}_L, &amp; V^{a}_L&gt;0\\
0, &amp; V^{a}_L=0
\end{cases}\]</p><p>Heat capacity (per ground area):</p><p class="math-container">\[C_L = c_s V^{s}_L + c_w(V^{w}_L+V^{v}_L) + c_i V^{i}_L\]</p><p>Layer thickness:</p><p class="math-container">\[\Delta z_L = V^{lyr}_L / A\]</p><p>Inputs</p><ul><li><code>Vlyr[L]</code>: total layer volume per ground area (your <code>snow_VolLyr_L[L]</code> concept)</li><li><code>Vs,Vw,Vi,Vv[L]</code>: stores (water-equivalent volumes per ground area)</li><li><code>cs,cw,ci</code>: heat capacities per water-equivalent volume</li><li><code>A</code>: area scaling (often <code>Area[3,NUM]</code>)</li></ul><p>Outputs (written in-place)</p><ul><li><code>Va[L]</code>: (V^{a}_L)</li><li><code>υ[L]</code>: (\upsilon_L)</li><li><code>C[L]</code>: (C_L)</li><li><code>dz[L]</code>: (\Delta z_L)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/hutx2309/Ace1.jl/blob/c0a263b763345f4dafc42292e443fa5c7ffb26b0/src/snow/Snow_Mod.jl#L90-L132">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Ace1.Snow_Mod.surf_flux"><a class="docstring-binding" href="#Ace1.Snow_Mod.surf_flux"><code>Ace1.Snow_Mod.surf_flux</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">surf_flux(T, Vs, Vw, Vi;
          SW, LW, epsσ,
          Tc, fc, Td, fd,
          Ta, υa,
          Ke, Kh,
          Lv, Ls, cw, cs,
          Ps, Pw, Pi, Qin,
          xA) -&gt; (Fs, Fw, Fi, Fh, diag)</code></pre><p>Snow surface exchange for the top snow layer (surface layer (L=1)).</p><p>This computes surface energy/mass exchange and returns the boundary fluxes at the snow–atmosphere interface (interface (1/2)).</p><p>State (top layer)</p><ul><li>(V^{s},V^{w},V^{i}): snow/solid, liquid water, and ice stores</li><li>(T): snow surface-layer temperature (K)</li></ul><p>Forcing/parameters</p><ul><li>Radiation: (SW<em>{\downarrow}, LW</em>{\downarrow}), emission factor (\varepsilon\sigma)</li><li>Canopy/standing-dead LW exchange: ((T<em>c,f</em>c)), ((T<em>d,f</em>d))</li><li>Air: ((T<em>a,\upsilon</em>a))</li><li>Bulk transfer coefficients: (K<em>e) (vapor), (K</em>h) (sensible)</li><li>Latent constants: ((L<em>v,L</em>s))</li><li>Exchanged-mass heat capacities: ((c<em>w,c</em>s))</li><li>Precip/additions: ((P^{s},P^{w},P^{i},Q_{in}))</li><li>Limiter factor: <code>xA</code> (your ecosys-style per-substep cap, e.g. <code>XNPAX</code>)</li></ul><p>Equations</p><p>Albedo closure (volume-weighted):</p><p class="math-container">\[\alpha
=
\frac{0.85\,V^{s}+0.30\,V^{i}+0.06\,V^{w}}{V^{s}+V^{i}+V^{w}}\]</p><p>Net radiation:</p><p class="math-container">\[R_n
=
(1-\alpha)SW_{\downarrow}+LW_{\downarrow}
-\varepsilon\sigma T^{4}
+\varepsilon\sigma(T_c^{4}-T^{4})f_c
+\varepsilon\sigma(T_d^{4}-T^{4})f_d\]</p><p>Vapor exchange:</p><p class="math-container">\[E^{\ast} = K_e\big(\upsilon_a-\upsilon^{\ast}(T)\big)\]</p><p>Partition (capped by availability):</p><p class="math-container">\[E^{w}=\max\!\left(E^{\ast},\; -\,V^{w}x_A\right),\qquad
E^{s}=\max\!\left(\min\!(0,E^{\ast}-E^{w}),\; -\,V^{s}x_A\right)\]</p><p>Latent + sensible:</p><p class="math-container">\[LE = L_v E^{w} + L_s E^{s},\qquad
H = K_h\,(T_a-T)\]</p><p>Advective/enthalpy correction (your sign rule):</p><p class="math-container">\[H_v
=
\begin{cases}
(c_wE^{w}+c_sE^{s})\,T,   &amp; E^{\ast}&lt;0\\
(c_wE^{w}+c_sE^{s})\,T_a, &amp; E^{\ast}\ge 0
\end{cases}\]</p><p>Total surface energy into snow:</p><p class="math-container">\[G_0 = R_n + LE + H + H_v\]</p><p>Boundary fluxes at interface (1/2):</p><p class="math-container">\[F^{s}_{1/2}=P^{s}+E^{s},\quad
F^{w}_{1/2}=P^{w}+E^{w},\quad
F^{i}_{1/2}=P^{i},\quad
F^{h}_{1/2}=Q_{in}+G_0\]</p><p>Outputs</p><ul><li>Returns <code>(Fs, Fw, Fi, Fh, diag)</code> where:<ul><li><code>Fs,Fw,Fi,Fh</code> correspond to (F^{s}<em>{1/2},F^{w}</em>{1/2},F^{i}<em>{1/2},F^{h}</em>{1/2})</li><li><code>diag</code> is a NamedTuple of helpful diagnostics ((\alpha,R<em>n,E^{w},E^{s},LE,H,H</em>v,G_0)).</li></ul></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/hutx2309/Ace1.jl/blob/c0a263b763345f4dafc42292e443fa5c7ffb26b0/src/snow/Snow_Mod.jl#L154-L246">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Ace1.Snow_Mod.surf_flux!"><a class="docstring-binding" href="#Ace1.Snow_Mod.surf_flux!"><code>Ace1.Snow_Mod.surf_flux!</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">surf_flux!(Fs, Fw, Fi, Fh, T, Vs, Vw, Vi; kwargs...)</code></pre><p>In-place wrapper for <a href="#Ace1.Snow_Mod.surf_flux"><code>surf_flux</code></a> that writes fluxes into <code>Ref</code>s:</p><p class="math-container">\[Fs[] = F^{s}_{1/2},\quad
Fw[] = F^{w}_{1/2},\quad
Fi[] = F^{i}_{1/2},\quad
Fh[] = F^{h}_{1/2}\]</p><p>See <a href="#Ace1.Snow_Mod.surf_flux"><code>surf_flux</code></a> for equations and parameter meanings.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/hutx2309/Ace1.jl/blob/c0a263b763345f4dafc42292e443fa5c7ffb26b0/src/snow/Snow_Mod.jl#L285-L298">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Ace1.Snow_Mod.flux_internal!"><a class="docstring-binding" href="#Ace1.Snow_Mod.flux_internal!"><code>Ace1.Snow_Mod.flux_internal!</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">flux_internal!(Fw, Fv, Fh, Vs, Vw, T, Va, υ, dz, k, Dv;
               A, fs, cw, xA, xY, θmin)</code></pre><p>Compute internal interface fluxes inside the snowpack.</p><p>Index convention for interface arrays (length (J+1)):</p><ul><li><code>index 1</code>  = interface (1/2) (set by <code>surf_flux!</code>)</li><li><code>index L+1</code> = interface (L+1/2)</li><li><code>index J+1</code> = interface (J+1/2) (set by <code>bottom_exchange!</code>)</li></ul><p>Typical equations (implementation pattern)</p><p>Liquid percolation (excess rule):</p><p class="math-container">\[q^{w}_{L+1/2}
= \min\!\left(\theta^{a}_{L+1},\; \max(0, V^{w}_{L}-0.05V^{s}_{L})\,x_A\right)\]</p><p>Vapor diffusion:</p><p class="math-container">\[q^{v}_{L+1/2} = K^{v}_{L+1/2}\,(\upsilon_{L}-\upsilon_{L+1})\]</p><p>Heat flux (conduction + liquid enthalpy):</p><p class="math-container">\[q^{h}_{L+1/2}
= K^{h}_{L+1/2}(T_L-T_{L+1}) + c_w T_L\,q^{w}_{L+1/2}\]</p><p>Implementation notes</p><ul><li>Harmonic means are used for conductances: (K^{v}<em>{L+1/2}\leftarrow\mathrm{hmean}(D</em>v[L],D<em>v[L+1],\Delta z</em>L,\Delta z<em>{L+1})), (K^{h}</em>{L+1/2}\leftarrow\mathrm{hmean}(k[L],k[L+1],\Delta z<em>L,\Delta z</em>{L+1})).</li><li><code>θmin</code> prevents zero “receiving capacity” in very dry/degenerate states; replace with your own physically-based cap if desired.</li><li><code>xY</code> is a scaling factor that you can use to mirror your <code>XNPYX</code>-style interface scaling; set <code>xY=1.0</code> if you don’t need it.</li></ul><p>Inputs</p><ul><li>Layer arrays: <code>Vs,Vw,T,Va,υ,dz,k,Dv</code></li><li>Scalars: <code>A</code> (area factor), <code>fs</code> (snow cover), <code>cw</code>, <code>xA</code>, <code>xY</code>, <code>θmin</code></li></ul><p>Outputs</p><ul><li>Writes for (L=1..J-1):<ul><li><code>Fw[L+1]</code> = liquid flux across (L+1/2)</li><li><code>Fv[L+1]</code> = vapor flux across (L+1/2) scaled by <code>A*fs*xY</code></li><li><code>Fh[L+1]</code> = heat flux across (L+1/2) scaled by <code>A*fs*xY</code></li></ul></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/hutx2309/Ace1.jl/blob/c0a263b763345f4dafc42292e443fa5c7ffb26b0/src/snow/Snow_Mod.jl#L316-L364">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Ace1.Snow_Mod.vapor_relax!"><a class="docstring-binding" href="#Ace1.Snow_Mod.vapor_relax!"><code>Ace1.Snow_Mod.vapor_relax!</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">vapor_relax!(Vs, Vw, Vv, Va, T; Lv, Ls, xA) -&gt; (Ww, Ws, Qv)</code></pre><p>In-layer vapor relaxation toward saturation.</p><p>This is the layer-local evaporation/condensation adjustment used to relax the vapor store (V^{v}) toward (\upsilon^{\ast}(T)V^{a}).</p><p>Equations</p><p class="math-container">\[\delta = V^{v} - \upsilon^{\ast}(T)\,V^{a}\]</p><p class="math-container">\[W^{w} = \max(\delta,\,-V^{w}x_A),\qquad
W^{s} = \max\big(\min(0,\delta-W^{w}),\,-V^{s}x_A\big)\]</p><p class="math-container">\[Q_v = L_v\,W^{w} + L_s\,W^{s}\]</p><p>Inputs</p><ul><li><code>Vs,Vw,Vv,Va,T</code>: layer-local stores and temperature</li><li><code>Lv,Ls</code>: latent constants (matching your model convention)</li><li><code>xA</code>: cap factor (like your <code>XNPAX</code>)</li></ul><p>Outputs</p><ul><li><code>Ww</code> corresponds to (W^{w}) (liquid exchange term)</li><li><code>Ws</code> corresponds to (W^{s}) (snow/solid exchange term)</li><li><code>Qv</code> corresponds to (Q_v) (latent energy term)</li></ul><p>Intended conservative application (matching your code’s sign convention):</p><ul><li><code>Vs ← Vs + Ws</code></li><li><code>Vw ← Vw + Ww</code></li><li><code>Vv ← Vv - (Ws + Ww)</code></li><li>Energy increment <code>+Qv</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/hutx2309/Ace1.jl/blob/c0a263b763345f4dafc42292e443fa5c7ffb26b0/src/snow/Snow_Mod.jl#L400-L438">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Ace1.Snow_Mod.Freeze_Thaw!"><a class="docstring-binding" href="#Ace1.Snow_Mod.Freeze_Thaw!"><code>Ace1.Snow_Mod.Freeze_Thaw!</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">freeze_thaw!(Vs, Vw, Vi, Vv, T; cs, cw, ci, Tf, Lf, xX, ρi) -&gt; (Wfs, Wfi, Qf)</code></pre><p>Freeze–thaw in a snow layer driven by thermal imbalance (ecosys-style).</p><p>This is a compact rewrite of your freeze–thaw block using short names.</p><p>Heat capacity proxy:</p><p class="math-container">\[C^{\ast}=c_sV^{s}+c_w(V^{w}+V^{v})+c_iV^{i}\]</p><p>Energy tendency:</p><p class="math-container">\[H_1 = C^{\ast}\,(T_f - T)/2.7185\cdot x_X\]</p><p>Branches (mirrors your code logic)</p><ul><li>If (H_1 &lt; 0): melting-like branch; partition among snow/ice by their fractions.</li><li>Else: freezing-like branch; limited by available liquid.</li></ul><p>Outputs</p><ul><li><code>Wfs</code> (analog of your <code>WFLFSX</code>): snow/solid melt term (subtracted from (V^{s}) update)</li><li><code>Wfi</code> (analog of your <code>WFLFIX</code>): liquid→ice term in water-equivalent units (ice update uses <code>-Wfi/ρi</code>)</li><li><code>Qf</code>  (analog of your <code>HFLF0X</code>): latent energy term</li></ul><p>Intended application (aligned with your original update pattern):</p><ul><li><code>Vs ← Vs - Wfs</code></li><li><code>Vw ← Vw + Wfs + Wfi</code></li><li><code>Vi ← Vi - Wfi/ρi</code></li><li>Energy increment <code>+Qf</code></li></ul><p>Notes</p><ul><li><code>Lf</code> corresponds to the “333” coefficient used in your code’s internal unit system.</li><li><code>xX</code> corresponds to your <code>XNPXX</code>.</li><li><code>ρi</code> corresponds to <code>soil_iceDensty</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/hutx2309/Ace1.jl/blob/c0a263b763345f4dafc42292e443fa5c7ffb26b0/src/snow/functions/SnowFun2_Freeze_Thaw.jl#L5-L41">source</a></section></details></article><article><details class="docstring" open="true"><summary id="Ace1.Snow_Mod.Snow_FluxEchg!"><a class="docstring-binding" href="#Ace1.Snow_Mod.Snow_FluxEchg!"><code>Ace1.Snow_Mod.Snow_FluxEchg!</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">Snow_FluxEchg!(Vs,Vw,Vi,Vv,T;
           Vlyr, A,
           Va, υ, C, dz,
           Fs,Fw,Fi,Fv,Fh,
           k,Dv,
           cs,cw,ci,
           Lv,Ls, Tf,Lf, ρi,
           xA,xX,xY, dt,
           sf,
           bottom_cb=bottom_exchange!) -&gt; bot</code></pre><p>One conservative snow substep (finite-volume style).</p><p>Orchestrates:</p><ol><li><code>layer_props!</code> (compute (V^{a},\upsilon,C,\Delta z))</li><li><code>surf_flux!</code> (top boundary fluxes at (1/2))</li><li><code>flux_internal!</code> (internal interfaces (L+1/2))</li><li><code>bottom_cb</code> (bottom boundary (J+1/2))</li><li>Flux divergence update</li><li>Operator-split sources: <code>vapor_relax!</code> and <code>freeze_thaw!</code></li></ol><p>Core update (flux divergence)</p><p>For any store (X\in{V^{s},V^{w},V^{i},V^{v}}):</p><p class="math-container">\[X_L^{n+1}
=
X_L^{n}
+
\left(F^{X}_{L-1/2} - F^{X}_{L+1/2}\right)\,\Delta t_s
+ S_L^{X}\]</p><p>Energy in (CT) form:</p><p class="math-container">\[(CT)_L^{n+1}
=
(CT)_L^{n}
+
\left(F^{h}_{L-1/2} - F^{h}_{L+1/2}\right)\,\Delta t_s
+ S_L^{E}\]</p><p>Inputs</p><ul><li>State arrays (length (J)): <code>Vs,Vw,Vi,Vv,T</code></li><li>Geometry: <code>Vlyr</code>, <code>A</code></li><li>Work arrays (length (J)): <code>Va,υ,C,dz</code></li><li>Interface flux arrays (length (J+1)): <code>Fs,Fw,Fi,Fv,Fh</code></li><li>Transport props: <code>k,Dv</code></li><li>Constants: <code>cs,cw,ci</code>, <code>Lv,Ls</code>, <code>Tf,Lf,ρi</code></li><li>Scaling factors:<ul><li><code>xA</code> (like <code>XNPAX</code>) caps per-substep removals</li><li><code>xX</code> (like <code>XNPXX</code>) freeze–thaw scaling</li><li><code>xY</code> (like <code>XNPYX</code>) interface scaling (set <code>1.0</code> if unused)</li></ul></li><li>Time step: <code>dt</code> (this is your (\Delta t_s) for the snow substep)</li><li><code>sf</code> (surface forcing NamedTuple) must include fields:<ul><li><code>SW, LW, epsσ, Tc, fc, Td, fd, Ta, υa, Ke, Kh, Ps, Pw, Pi, Qin, fs, θmin</code></li></ul></li></ul><p>Outputs</p><ul><li>Updates the state arrays in-place.</li><li>Returns the NamedTuple from <code>bottom_cb</code> (so you can access partitioned diagnostics if you include them).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/hutx2309/Ace1.jl/blob/c0a263b763345f4dafc42292e443fa5c7ffb26b0/src/snow/Snow_Mod.jl#L459-L521">source</a></section></details></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../WaterFlux_Exchange_Soil/">« AiECO Soil Water Core</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.17.0 on <span class="colophon-date" title="Saturday 28 February 2026 00:31">Saturday 28 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
